# ODA Canvas Helm Values
# Reference: https://github.com/tmforum-oda/oda-canvas

global:
  image:
    registry: ""
  imagePullSecrets: []

# Prerequisites checks
preqrequisitechecks:
  istio: true

# Istio certificate configuration
istioCert:
  namespace: "istio-ingress"
  certificate:
    duration: 21600h
    renewBefore: 360h

# ODA CRDs
oda-crds:
  enabled: true

# Canvas namespaces configuration
canvas-namespaces:
  enabled: true
  certManagerNamespace: cert-manager
  componentNamespace: components
  istio:
    labelEnabledComponent: true

# Cert-manager configuration (cert-manager already installed separately)
cert-manager-init:
  namespace: canvas
  certificateDuration: 21600h
  leaseWaitTimeonStartup: 80
  cert-manager:
    enabled: false
    installCRDs: false
    namespace: cert-manager

# Keycloak configuration
keycloak:
  enabled: true
  image:
    repository: bitnamilegacy/keycloak
    tag: 20.0.5-debian-11-r2
  auth:
    adminUser: "admin"
    adminPassword: "adpass"
  postgresql:
    enabled: true
    image:
      repository: bitnamilegacy/postgresql
      tag: 15.2.0-debian-11-r31
    auth:
      username: "keycloak"
      password: "keycloakdbuser"
      postgresPassword: "postgresadmin"
      database: "keycloak"
    primary:
      persistence:
        storageClass: "gp2"
  httpRelativePath: "/auth/"
  tls:
    enabled: true
    autoGenerated: true
  service:
    ports:
      http: 8083
      https: 8443
  containerPorts:
    http: 8083
    https: 8443
  keycloakConfigCli:
    enabled: true
    image:
      repository: bitnamilegacy/keycloak-config-cli
      tag: 5.5.0-debian-11-r35
    backoffLimit: 1

# Component operator
oda-controller:
  enabled: true

# API operator (Istio)
api-operator-istio:
  enabled: true
  deployment:
    operatrorName: api-operator-istio
    apiopImage: tmforumodacanvas/api-operator-istio
    apiopVersion: 1.0.1
    imagePullPolicy: IfNotPresent
    istioGateway: true
    monitoredNamespaces: 'components'
    hostName: "*"
    httpsRedirect: false
    credentialName: istio-ingress-cert
  configmap:
    loglevel: '20'
    componentGateway: 'canvas/component-gateway'

# Identity operator
identityoperator:
  enabled: true

# Secrets management operator (disabled - requires Vault)
# Note: This chart has no enabled flag, so we set replicas to 0 to prevent deployment
secretsmanagement-operator:
  replicas: 0

# Dependency operator
dependentapi-simple-operator:
  enabled: true

# Service inventory (set storage class for mongodb)
service-inventory:
  persistence:
    storageClassName: "gp2"

# Disable Vault (not needed for this demo)
canvas-vault:
  enabled: false

# =============================================================================
# PDB Management Operator
# =============================================================================
pdb-management-operator:
  enabled: true

  deployment:
    operatorName: pdb-management-operator
    image: tmforumodacanvas/pdb-management-operator
    version: 1.0.0
    imagePullPolicy: IfNotPresent
    watchNamespace: ''  # Empty = watch all namespaces
    enableWebhook: true
    enableMetrics: true
    metricsAddr: "0.0.0.0:8080"
    probeAddr: "0.0.0.0:8081"

  # Observability configuration
  observability:
    logLevel: "info"
    # Structured JSON logging for better parsing
    logFormat: "json"
    tracing:
      enabled: true
      # OTLP endpoint for distributed tracing (if using Jaeger/Tempo)
      otlpEndpoint: ""
      sampleRate: "1.0"

  # ServiceMonitor for Prometheus scraping
  serviceMonitor:
    enabled: true
    namespace: monitoring
    interval: 30s
    scrapeTimeout: 10s
    labels:
      release: prometheus

  configuration:
    enablePDB: true
    defaultNamespace: "components"
    metricsNamespace: "canvas"
    leaderElectionNamespace: "canvas"
